import csv
import os
from unittest.mock import Mock

from src.csv_excel import WEY_TO_FILE_CSV, reading_financial_transactions_csv, reading_financial_transactions_excel

wey_to_excel = os.path.join(os.path.dirname(__file__), "../csv_excel/test_Excel.xlsx")


def test_reading_financial_transactions_csv():
    mock_transaction = Mock(
        return_value=[
            {
                "id": "650703",
                "state": "EXECUTED",
                "date": "2023-09-05T11:30:32Z",
                "amount": "16210",
                "currency_name": "Sol",
                "currency_code": "PEN",
                "from": "Счет 58803664561298323391",
                "to": "Счет 39745660563456619397",
                "description": "Перевод организации",
            }
        ]
    )
    csv.DictReader = mock_transaction
    assert reading_financial_transactions_csv(WEY_TO_FILE_CSV) == [
        {
            "id": "650703",
            "state": "EXECUTED",
            "date": "2023-09-05T11:30:32Z",
            "amount": "16210",
            "currency_name": "Sol",
            "currency_code": "PEN",
            "from": "Счет 58803664561298323391",
            "to": "Счет 39745660563456619397",
            "description": "Перевод организации",
        }
    ]


def test_reading_financial_transactions_excel():
    mock_transaction = Mock(
        return_value=[
            {
                "id": "650703",
                "state": "EXECUTED",
                "date": "2023-09-05T11:30:32Z",
                "amount": "16210",
                "currency_name": "Sol",
                "currency_code": "PEN",
                "from": "Счет 58803664561298323391",
                "to": "Счет 39745660563456619397",
                "description": "Перевод организации",
            }
        ]
    )
    csv.DictReader = mock_transaction
    assert reading_financial_transactions_excel(wey_to_excel) == [
        {
            "id": 650703.0,
            "state": "EXECUTED",
            "date": "2023-09-05T11:30:32Z",
            "amount": 16210.0,
            "currency_name": "Sol",
            "currency_code": "PEN",
            "from": "Счет 58803664561298323391",
            "to": "Счет 39745660563456619397",
            "description": "Перевод организации",
        }
    ]
